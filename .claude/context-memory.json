{
  "version": "1.0",
  "saved_at": "2025-12-25T12:00:00Z",
  "project": {
    "name": "Personal-Q AI Agent Management System",
    "path": "/Users/oeftimie/work/ai/personal-Q"
  },
  "session": {
    "summary": "Planning staging deployment to Railway. Analyzed project requirements vs Railway capabilities, made key architecture decisions.",
    "goal": "Deploy Personal-Q to staging environment on Railway",
    "progress": "25% - Research and decision phase complete, ready to implement"
  },
  "decisions": [
    {
      "topic": "Staging Domain",
      "decision": "stage.personal-q.eovidiu.co.uk",
      "rationale": "Custom domain required for Google OAuth callback (ephemeral Railway URLs don't work)"
    },
    {
      "topic": "Production Domain",
      "decision": "personal-q.eovidiu.co.uk",
      "rationale": "Consistent naming convention with staging"
    },
    {
      "topic": "Vector Database",
      "decision": "Migrate from ChromaDB to LanceDB",
      "rationale": "Lower memory usage (Rust-based), simpler persistence (single .lance file), no memory leak issues, better suited for Railway resource limits"
    },
    {
      "topic": "Vector DB Architecture",
      "decision": "Embedded in backend service",
      "rationale": "Simpler deployment, shares volume with SQLite, user preference"
    },
    {
      "topic": "Data Persistence",
      "decision": "Single Railway volume for SQLite + LanceDB at /app/data/",
      "rationale": "Both databases use file-based storage, simplifies backup and management"
    }
  ],
  "pending_tasks": [
    {
      "task": "Decide: Deploy now with ChromaDB or migrate to LanceDB first",
      "priority": "high",
      "blockers": ["Awaiting user decision"]
    },
    {
      "task": "Migrate ChromaDB to LanceDB",
      "priority": "high",
      "blockers": ["Pending user decision on timing"],
      "estimated_effort": "2-3 hours",
      "files_to_modify": [
        "backend/pyproject.toml",
        "backend/app/db/chroma_client.py -> lance_client.py",
        "backend/app/services/memory_service.py",
        "backend/tests/unit/test_memory_service.py"
      ]
    },
    {
      "task": "Create production-ready frontend Dockerfile",
      "priority": "high",
      "blockers": [],
      "rationale": "Current Dockerfile runs dev server, need static build for production"
    },
    {
      "task": "Configure DNS CNAME records",
      "priority": "high",
      "blockers": ["Need Railway project domain first"]
    },
    {
      "task": "Update Google Cloud Console OAuth credentials",
      "priority": "high",
      "blockers": ["Need final Railway URLs"]
    },
    {
      "task": "Create Railway project and deploy services",
      "priority": "medium",
      "blockers": ["Pending ChromaDB/LanceDB decision"]
    },
    {
      "task": "Run validation checklist after deployment",
      "priority": "medium",
      "blockers": ["Deployment must complete first"]
    }
  ],
  "files_modified": [],
  "key_context": [
    {
      "topic": "Project Status",
      "details": "Application is 100% complete per GitHub issue #48. All 5 phases done: Foundation, Core Features, Missing Features, Testing Infrastructure, Documentation."
    },
    {
      "topic": "Test Coverage",
      "details": "Backend: 95% coverage, 9/9 TrendCalculator tests passing. Frontend: 41/57 Playwright tests passing (72%)."
    },
    {
      "topic": "Railway Account",
      "details": "User is logged in, has 5 existing Railway projects, no Personal-Q project yet"
    },
    {
      "topic": "Railway Billing",
      "details": "Usage-based pricing, separate from any subscription. Hobby plan includes $5 credit. Estimated staging cost: $8-14/month"
    },
    {
      "topic": "Required Services",
      "details": "5 Railway services needed: Backend (FastAPI), Celery Worker, Celery Beat, Frontend (static), Redis. Plus 1 volume for data."
    },
    {
      "topic": "ChromaDB Current Integration",
      "details": "Clean abstraction in 2 files: chroma_client.py (94 lines) and memory_service.py (331 lines). Used in 9 files total. Migration to LanceDB is straightforward."
    },
    {
      "topic": "Security Considerations",
      "details": "Test auth endpoint auto-disabled in production (ENV=production). CORS validation blocks localhost in production. JWT secret must be 32+ chars."
    }
  ],
  "blockers": [
    {
      "issue": "ChromaDB vs LanceDB migration timing",
      "severity": "minor",
      "proposed_solution": "User needs to decide: deploy now with ChromaDB or migrate first. Migration estimated 2-3 hours."
    }
  ],
  "technical_notes": [
    {
      "topic": "Railway Volume Persistence",
      "details": "Without volume, database resets on every deployment. Must attach volume to /app/data/ for SQLite and LanceDB persistence."
    },
    {
      "topic": "Google OAuth on Railway",
      "details": "Requires stable domain (not ephemeral). Custom domain or permanent Railway domain needed. Redirect URI must match exactly."
    },
    {
      "topic": "Railway WebSocket Support",
      "details": "Full support - long-running processes with no function timeouts or invocation limits."
    },
    {
      "topic": "LanceDB Benefits",
      "details": "Rust-based (low memory), single .lance file format, 100x faster than Parquet, zero-copy versioning, used by Midjourney at scale."
    },
    {
      "topic": "Frontend Dockerfile Issue",
      "details": "Current Dockerfile.frontend runs Vite dev server (npm run dev). Need production build with nginx or similar for staging/production."
    },
    {
      "topic": "Environment Variables Required",
      "details": "ENV, DATABASE_URL, CHROMA_DB_PATH (or LANCE_DB_PATH), REDIS_URL, CELERY_BROKER_URL, CELERY_RESULT_BACKEND, ENCRYPTION_KEY, JWT_SECRET_KEY, GOOGLE_CLIENT_ID, GOOGLE_CLIENT_SECRET, ALLOWED_EMAIL, CORS_ORIGINS"
    }
  ],
  "next_steps": [
    "Get user decision: Deploy with ChromaDB now OR migrate to LanceDB first",
    "If migrating: Replace chromadb with lancedb in pyproject.toml, rewrite client and service",
    "Create production frontend Dockerfile (static build + nginx)",
    "Create Railway project 'personal-q-staging'",
    "Add Redis from Railway marketplace",
    "Deploy Backend, Celery Worker, Celery Beat, Frontend services",
    "Attach volume to backend at /app/data/",
    "Generate Railway domain and configure DNS CNAME",
    "Update Google Cloud Console with OAuth redirect URIs",
    "Set all environment variables in Railway",
    "Run validation checklist (docs/validation-checklist.md)"
  ]
}
